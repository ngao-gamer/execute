local TweenService = game:GetService('TweenService') 
local RunService = game:GetService('RunService')

local Player = game:GetService('Players').LocalPlayer
local PlayerGui = Player:WaitForChild('PlayerGui')
local NotificationPrefix = 'ExecutedNotification_'
local MaxNotifications = 3

-- 1. KIỂM TRA VÀ HỦY THÔNG BÁO CŨ NHẤT NẾU VƯỢT QUÁ GIỚI HẠN (MAX 4)
local existingCount = 0
local oldestNotification = nil 

for _, child in ipairs(PlayerGui:GetChildren()) do
    -- Kiểm tra tiền tố và loại đối tượng
    if child.Name:sub(1, #NotificationPrefix) == NotificationPrefix and child:IsA('ScreenGui') then
        existingCount = existingCount + 1
        -- Sử dụng tên có dấu thời gian (tick()) để xác định cái nào cũ hơn
        if oldestNotification == nil or child.Name < oldestNotification.Name then
            oldestNotification = child 
        end
    end
end

if existingCount >= MaxNotifications and oldestNotification then
    oldestNotification:Destroy() -- Hủy thông báo cũ nhất
end

-- 2. TẠO THÔNG BÁO MỚI
local Notification = Instance.new('ScreenGui')
-- Gán tên duy nhất để theo dõi (dùng tick() để đảm bảo tính duy nhất và thứ tự)
Notification.Name = NotificationPrefix .. tostring(math.floor(tick() * 1000))
Notification.DisplayOrder = 999 

-- Khung chính của thông báo (Frame)
local Frame = Instance.new('Frame')
Frame.Size = UDim2.new(0, 300, 0, 80) -- Kích thước mặc định
Frame.Position = UDim2.new(1, -320, 0, 20) -- Vị trí góc trên bên phải (cách 20px)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35) -- Tối hơn để tăng độ tương phản
Frame.BorderSizePixel = 5 -- QUAN TRỌNG: Tăng độ dày viền lên 5px
Frame.BorderColor3 = Color3.fromRGB(30, 144, 255) -- DodgerBlue (Màu xanh sáng)
Frame.Draggable = true 
Frame.Parent = Notification

-- Thêm góc bo tròn (UI Corner)
local Corner = Instance.new('UICorner')
Corner.CornerRadius = UDim.new(0, 8) 
Corner.Parent = Frame

-- Label Nội dung chính: Executed ✓
local Content = Instance.new('TextLabel')
Content.Text = 'Executed ✓'
Content.TextColor3 = Color3.fromRGB(173, 255, 47) -- Lime Green sáng
Content.TextSize = 24 -- Tăng cỡ chữ để trông hiện đại hơn
Content.Font = Enum.Font.SourceSansBold
Content.BackgroundTransparency = 1
-- Đã điều chỉnh chiều cao của Content để chừa chỗ 2px cho thanh tiến trình
Content.Size = UDim2.new(1, 0, 1, -2) 
Content.TextYAlignment = Enum.TextYAlignment.Center
Content.Position = UDim2.new(0, 0, 0, 0)
Content.Parent = Frame

-- Thanh Tiến Trình (Progress Bar) - Nằm ở dưới cùng
local ProgressBar = Instance.new('Frame')
ProgressBar.Name = "ProgressBar"
ProgressBar.BackgroundColor3 = Color3.fromRGB(30, 144, 255) -- Dùng màu viền cho Progress Bar
ProgressBar.Size = UDim2.new(1, 0, 0, 2) -- ĐIỀU CHỈNH: Chiều cao 2px
ProgressBar.Position = UDim2.new(0, 0, 1, -2) -- Đặt ở dưới cùng (cách mép dưới 2px)
ProgressBar.BorderSizePixel = 0
ProgressBar.Parent = Frame

-- Hàm xử lý hiệu ứng đóng (Tweening)
local function dismissNotification()
    if not Frame.Parent then return end 

    local DismissTime = 0.3
    local DismissInfo = TweenInfo.new(DismissTime, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    
    local Goal = {
        Position = UDim2.new(1.1, 0, Frame.Position.Y.Scale, Frame.Position.Y.Offset) 
    }
    
    local Tween = TweenService:Create(Frame, DismissInfo, Goal)
    Tween:Play()
    
    Tween.Completed:Wait() 
    Notification:Destroy()
end

-- Tween cho thanh tiến trình
local function startProgressBar()
    local Duration = 2.3 -- 3 giây
    local ProgressInfo = TweenInfo.new(Duration, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
    
    local Goal = {
        Size = UDim2.new(0, 0, 0, 2) -- ĐIỀU CHỈNH: Mục tiêu chiều cao 2px
    }
    
    local ProgressTween = TweenService:Create(ProgressBar, ProgressInfo, Goal)
    ProgressTween:Play()
    
    ProgressTween.Completed:Wait() 
end

Notification.Parent = PlayerGui

-- Chạy thanh tiến trình và sau đó đóng thông báo
coroutine.wrap(function()
    startProgressBar() -- Bắt đầu thanh tiến trình (chờ 3 giây)
    dismissNotification() -- Thực hiện hiệu ứng trượt và hủy
end)()
