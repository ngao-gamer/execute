local TweenService = game:GetService('TweenService') 
local RunService = game:GetService('RunService')

local Player = game:GetService('Players').LocalPlayer
local PlayerGui = Player:WaitForChild('PlayerGui')
local NotificationPrefix = 'ExecutedNotification_'
local MaxNotifications = 4
local Duration = 4 -- Thời gian hiển thị 4 giây

-- 1. KIỂM TRA VÀ HỦY THÔNG BÁO CŨ NHẤT NẾU VƯỢT QUÁ GIỚI HẠN (MAX 4)
local existingCount = 0
local oldestNotification = nil 

for _, child in ipairs(PlayerGui:GetChildren()) do
    if child.Name:sub(1, #NotificationPrefix) == NotificationPrefix and child:IsA('ScreenGui') then
        existingCount = existingCount + 1
        -- Tìm thông báo cũ nhất (thông báo đầu tiên tìm thấy)
        if oldestNotification == nil then
            oldestNotification = child 
        end
    end
end

if existingCount >= MaxNotifications and oldestNotification then
    oldestNotification:Destroy() -- Hủy thông báo cũ nhất
end

-- 2. TẠO THÔNG BÁO MỚI
local Notification = Instance.new('ScreenGui')
Notification.Name = NotificationPrefix .. tostring(math.floor(tick() * 1000))
Notification.DisplayOrder = 999 

-- Khung chính của thông báo (Frame)
local Frame = Instance.new('Frame')
Frame.Size = UDim2.new(0, 250, 0, 45) -- Kích thước nhỏ gọn: 250x45
-- Vị trí ban đầu: Hoàn toàn ngoài màn hình bên phải
Frame.Position = UDim2.new(1.1, 0, 0, 20) 
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BorderSizePixel = 3 -- Độ dày viền 3px
Frame.BorderColor3 = Color3.fromRGB(30, 144, 255) -- DodgerBlue
Frame.Draggable = true 
Frame.Parent = Notification

-- Thêm góc bo tròn (UI Corner)
local Corner = Instance.new('UICorner')
Corner.CornerRadius = UDim.new(0, 8) 
Corner.Parent = Frame

-- Thanh Tiến trình (Progress Bar)
local ProgressBar = Instance.new('Frame')
ProgressBar.Size = UDim2.new(1, 0, 0, 3) -- Chiều cao 3px
ProgressBar.Position = UDim2.new(0, 0, 1, -3) -- Đặt ở đáy Frame
ProgressBar.BackgroundColor3 = Color3.fromRGB(173, 255, 47) -- Lime Green
ProgressBar.BorderSizePixel = 0
ProgressBar.Parent = Frame

-- Label Nội dung chính
local Content = Instance.new('TextLabel')
Content.Text = 'Purium\nExecuted Script \xE2\x9C\x93' -- Executed Script ✓
Content.TextColor3 = Color3.fromRGB(50, 255, 50) -- Xanh lá cây sáng
Content.TextSize = 16
Content.Font = Enum.Font.SourceSansBold
Content.TextYAlignment = Enum.TextYAlignment.Center
Content.TextWrapped = true
Content.BackgroundTransparency = 1
Content.Size = UDim2.new(1, 0, 1, -3) -- Trừ 3px chiều cao thanh progress
Content.Position = UDim2.new(0, 0, 0, 0)
Content.Parent = Frame

Notification.Parent = PlayerGui

-- Vị trí mục tiêu cuối cùng (Final Target Position)
local TargetPos = UDim2.new(1, -270, 0, 20) -- 270 = 250 (width) + 20 (padding)

-- *****************************************************************
-- 3. HOẠT ẢNH XUẤT HIỆN (SLIDE-OVER-BOUNCE)
-- *****************************************************************

local function playEntryAnimation()
    -- Vị trí trượt quá mục tiêu (10px overshoot)
    local OvershootPos = UDim2.new(1, -280, 0, 20) 

    -- Tween 1: Trượt quá đà (Overshoot)
    local Tween1Info = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local Tween1 = TweenService:Create(Frame, Tween1Info, {Position = OvershootPos})
    Tween1:Play()
    Tween1.Completed:Wait()

    -- Tween 2: Rút về vị trí cuối cùng (Bounce)
    local Tween2Info = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local Tween2 = TweenService:Create(Frame, Tween2Info, {Position = TargetPos})
    Tween2:Play()
    Tween2.Completed:Wait()
end

-- *****************************************************************
-- 4. HOẠT ẢNH BIẾN MẤT (PROGRESS BAR + BUMP-EXIT)
-- *****************************************************************

local function dismissNotification()
    if not Frame.Parent then return end 

    -- Tween 3: Thanh tiến trình (4 giây)
    local ProgressTweenInfo = TweenInfo.new(Duration, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
    local ProgressTween = TweenService:Create(ProgressBar, ProgressTweenInfo, {Size = UDim2.new(0, 0, 0, 3)})
    ProgressTween:Play()
    
    ProgressTween.Completed:Wait()

    -- Tween 4 (Prep-Exit): Nhúc nhích ra ngoài (10px bump)
    local BumpOutPos = UDim2.new(1, -260, Frame.Position.Y.Scale, Frame.Position.Y.Offset)
    local BumpTweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local BumpTween = TweenService:Create(Frame, BumpTweenInfo, {Position = BumpOutPos})
    BumpTween:Play()
    BumpTween.Completed:Wait()

    -- Tween 5 (Final Retreat): Trượt ra khỏi màn hình
    local DismissTime = 0.3
    local DismissInfo = TweenInfo.new(DismissTime, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local Goal = {
        Position = UDim2.new(1.1, 0, Frame.Position.Y.Scale, Frame.Position.Y.Offset) 
    }
    
    local TweenFinal = TweenService:Create(Frame, DismissInfo, Goal)
    TweenFinal:Play()
    
    TweenFinal.Completed:Wait() 
    Notification:Destroy()
end

-- Bắt đầu hoạt ảnh xuất hiện
playEntryAnimation()

-- Bắt đầu quá trình tự hủy
dismissNotification()
